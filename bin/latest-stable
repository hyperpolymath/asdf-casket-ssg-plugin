#!/usr/bin/env bash
# SPDX-License-Identifier: PMPL-1.0-or-later
# Copyright (c) 2024 hyperpolymath
# asdf-casket-ssg: Get the latest stable casket-ssg version

set -euo pipefail

# Get the plugin directory
PLUGIN_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"

# Source utility functions
# shellcheck source=lib/utils.bash
source "${PLUGIN_DIR}/lib/utils.bash"

# Optional filter query (passed as first argument)
FILTER="${1:-}"

# Main
check_dependencies

latest="$(get_latest_stable)"

if [[ -n "${FILTER}" ]]; then
  # Apply filter if provided (e.g., "1" would match 1.x.x versions)
  echo "${latest}" | grep -E "^${FILTER}" || echo "${latest}"
else
  echo "${latest}"
fi
